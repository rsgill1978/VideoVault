<!--
    VideoPlayerControl.axaml

    This control provides a video player interface with playback controls.
    The control uses LibVLC for video rendering via a NativeControlHost.

    Layout Structure:
    - Outer Grid with 1 row containing entire control
    - Inner Grid with 2 rows: video area (Row 0) and controls (Row 1)
    - Overlay controls (Row 0 of outer grid) for fullscreen mode

    Fullscreen Mode Behavior:
    - Normal mode: Inner grid controls visible in Row 1, overlay hidden
    - Fullscreen mode: Inner grid controls hidden, overlay controls visible and positioned over video
    - Overlay controls have ZIndex=100 to render above video
    - Controls have semi-transparent dark background for visibility
    - Controls auto-hide after 3 seconds of inactivity
-->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="VideoVault.Controls.VideoPlayerControl">

    <!-- Outer panel that holds both the normal layout and fullscreen overlay -->
    <Panel>
        <!-- Inner grid with normal layout: video area and controls below -->
        <Grid RowDefinitions="*,Auto" Name="NormalLayout" ZIndex="0">

            <!-- Video Display Area (Row 0) - Black panel containing the video renderer -->
            <Panel Grid.Row="0" Background="Black" Name="VideoContainer"
                   ToolTip.Tip="Video display area - Double-click to toggle fullscreen mode. Move mouse in fullscreen to show controls.">

                <!-- NativeControlHost for LibVLC video rendering - Stretches to fill entire video area -->
                <!-- This is replaced at runtime with VlcNativeControlHost for proper Windows handle management -->
                <NativeControlHost Name="VideoHost" IsVisible="True"
                                 HorizontalAlignment="Stretch"
                                 VerticalAlignment="Stretch"
                                 ToolTip.Tip="Video rendering surface"/>

                <!-- Placeholder text shown when no video is loaded -->
                <TextBlock Text="No video loaded"
                          Foreground="White"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Name="NoVideoText"
                          ToolTip.Tip="Load a video to begin playback"/>
            </Panel>

            <!-- Player Controls (Row 1) - Normal windowed mode controls -->
            <Border Grid.Row="1"
                    Background="#F0F0F0"
                    Padding="10"
                    Name="PlayerControls"
                    ToolTip.Tip="Video playback controls - Automatically hide in fullscreen after 3 seconds">

                <!-- Control panel layout: 4 columns (play button, progress slider, volume controls, fullscreen button) -->
                <Grid ColumnDefinitions="Auto,*,Auto,Auto">

                    <!-- Play/Pause Button (Column 0) - Toggles between play and pause states -->
                    <Button Grid.Column="0" Name="PlayPauseButton" Click="PlayPauseButton_Click"
                           Width="40" Height="40" Margin="0,0,10,0"
                           ToolTip.Tip="Click to play or pause the video. Shows â–¶ when paused, â¸ when playing.">
                        <!-- Button icon text - Updated dynamically based on playback state -->
                        <TextBlock Text="â–¶" FontSize="20" HorizontalAlignment="Center"/>
                    </Button>

                    <!-- Progress Slider and Time Display (Column 1) - Fills remaining space -->
                    <Grid Grid.Column="1" RowDefinitions="Auto,Auto">

                        <!-- Video progress slider - Range 0-100 representing 0%-100% of video duration -->
                        <Slider Grid.Row="0" Name="ProgressSlider"
                               Minimum="0" Maximum="100"
                               ValueChanged="ProgressSlider_ValueChanged"
                               ToolTip.Tip="Drag to seek through the video. Click anywhere on the bar to jump to that position."/>

                        <!-- Time display - Shows current time and total duration -->
                        <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" Margin="0,5,0,0">

                            <!-- Current playback time (left side) -->
                            <TextBlock Grid.Column="0" Name="TimeText" Text="00:00:00"
                                     FontSize="11" VerticalAlignment="Center"
                                     ToolTip.Tip="Current playback position"/>

                            <!-- Total video duration (right side) -->
                            <TextBlock Grid.Column="2" Name="DurationText" Text="00:00:00"
                                     FontSize="11" VerticalAlignment="Center"
                                     ToolTip.Tip="Total video duration"/>
                        </Grid>
                    </Grid>

                    <!-- Volume Control (Column 2) - Mute button and volume slider -->
                    <Grid Grid.Column="2" ColumnDefinitions="Auto,Auto" Margin="10,0,10,0">

                        <!-- Volume/Mute Button - Cycles through volume icons: ðŸ”‡ (muted), ðŸ”‰ (low), ðŸ”Š (high) -->
                        <Button Grid.Column="0" Name="VolumeButton" Click="VolumeButton_Click"
                               Width="40" Height="40"
                               ToolTip.Tip="Click to mute or unmute audio. Icon changes based on volume level.">
                            <!-- Volume icon - Updated dynamically based on volume level -->
                            <TextBlock Text="ðŸ”Š" FontSize="16"/>
                        </Button>

                        <!-- Volume slider - Range 0-100 representing volume percentage -->
                        <Slider Grid.Column="1" Name="VolumeSlider"
                               Width="100" Minimum="0" Maximum="100" Value="100"
                               ValueChanged="VolumeSlider_ValueChanged"
                               VerticalAlignment="Center"
                               ToolTip.Tip="Adjust playback volume from 0 (muted) to 100 (maximum). Current value updates icon."/>
                    </Grid>

                    <!-- Fullscreen Button (Column 3) - Toggles fullscreen mode -->
                    <Button Grid.Column="3" Name="FullscreenButton" Click="FullscreenButton_Click"
                           Width="40" Height="40"
                           ToolTip.Tip="Toggle fullscreen mode. Press ESC or click this button again to exit fullscreen.">
                        <!-- Fullscreen icon -->
                        <TextBlock Text="â›¶" FontSize="20"/>
                    </Button>

                </Grid>
            </Border>

        </Grid>

        <!-- Fullscreen overlay controls - Hidden in normal mode, visible in fullscreen -->
        <!-- DockPanel with controls docked to bottom - simple and works everywhere -->
        <!-- ZIndex 100 ensures this renders above video and normal layout -->
        <DockPanel Name="FullscreenControlsCanvas"
                   IsVisible="False"
                   ZIndex="100"
                   HorizontalAlignment="Stretch"
                   VerticalAlignment="Stretch"
                   LastChildFill="False">

            <!-- Border docked to bottom -->
            <Border Name="FullscreenControls"
                    DockPanel.Dock="Bottom"
                    Background="#CC000000"
                    Padding="20"
                    HorizontalAlignment="Stretch"
                    ToolTip.Tip="Fullscreen playback controls - Move mouse to show, automatically hide after 3 seconds">

            <!-- Same control layout as normal mode -->
            <Grid ColumnDefinitions="Auto,*,Auto,Auto">

                <!-- Play/Pause Button for fullscreen -->
                <Button Grid.Column="0" Name="FullscreenPlayPauseButton" Click="PlayPauseButton_Click"
                       Width="40" Height="40" Margin="0,0,10,0"
                       ToolTip.Tip="Click to play or pause the video. Shows â–¶ when paused, â¸ when playing.">
                    <TextBlock Name="FullscreenPlayPauseIcon" Text="â–¶" FontSize="20" HorizontalAlignment="Center" Foreground="White"/>
                </Button>

                <!-- Progress Slider and Time Display for fullscreen -->
                <Grid Grid.Column="1" RowDefinitions="Auto,Auto">
                    <Slider Grid.Row="0" Name="FullscreenProgressSlider"
                           Minimum="0" Maximum="100"
                           ValueChanged="ProgressSlider_ValueChanged"
                           ToolTip.Tip="Drag to seek through the video. Click anywhere on the bar to jump to that position."/>

                    <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" Margin="0,5,0,0">
                        <TextBlock Grid.Column="0" Name="FullscreenTimeText" Text="00:00:00"
                                 FontSize="11" VerticalAlignment="Center" Foreground="White"
                                 ToolTip.Tip="Current playback position"/>
                        <TextBlock Grid.Column="2" Name="FullscreenDurationText" Text="00:00:00"
                                 FontSize="11" VerticalAlignment="Center" Foreground="White"
                                 ToolTip.Tip="Total video duration"/>
                    </Grid>
                </Grid>

                <!-- Volume Control for fullscreen -->
                <Grid Grid.Column="2" ColumnDefinitions="Auto,Auto" Margin="10,0,10,0">
                    <Button Grid.Column="0" Name="FullscreenVolumeButton" Click="VolumeButton_Click"
                           Width="40" Height="40"
                           ToolTip.Tip="Click to mute or unmute audio. Icon changes based on volume level.">
                        <TextBlock Name="FullscreenVolumeIcon" Text="ðŸ”Š" FontSize="16" Foreground="White"/>
                    </Button>

                    <Slider Grid.Column="1" Name="FullscreenVolumeSlider"
                           Width="100" Minimum="0" Maximum="100" Value="100"
                           ValueChanged="VolumeSlider_ValueChanged"
                           VerticalAlignment="Center"
                           ToolTip.Tip="Adjust playback volume from 0 (muted) to 100 (maximum). Current value updates icon."/>
                </Grid>

                <!-- Fullscreen Button for fullscreen mode -->
                <Button Grid.Column="3" Name="FullscreenExitButton" Click="FullscreenButton_Click"
                       Width="40" Height="40"
                       ToolTip.Tip="Exit fullscreen mode. You can also press ESC key.">
                    <TextBlock Text="â›¶" FontSize="20" Foreground="White"/>
                </Button>

            </Grid>
            </Border>

        </DockPanel>

    </Panel>
</UserControl>
